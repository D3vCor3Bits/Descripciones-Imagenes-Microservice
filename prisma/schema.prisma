generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model DESCRIPCION {
  idDescripcion Int       @id @default(autoincrement())
  texto         String
  fecha         DateTime  @default(now()) @db.Timestamptz(6)
  idImagen      Int       @unique
  idPaciente    String?   @db.Uuid
  IMAGEN        IMAGEN    @relation(fields: [idImagen], references: [idImagen], onDelete: Cascade, onUpdate: NoAction)
  PUNTAJE       PUNTAJE[]
}

model GROUNDTRUTH {
  idGroundtruth         Int      @id @default(autoincrement())
  texto                 String
  fecha                 DateTime @default(now()) @db.Timestamptz(6)
  idImagen              Int      @unique
  palabrasClave         String[]
  preguntasGuiaPaciente String[]
  IMAGEN                IMAGEN   @relation(fields: [idImagen], references: [idImagen], onDelete: Cascade, onUpdate: NoAction)
}

model IMAGEN {
  idImagen      Int          @id @default(autoincrement())
  urlImagen     String
  fechaSubida   DateTime     @default(now()) @db.Timestamptz(6)
  idAsset       String?
  idPublicImage String?
  formato       String?
  idCuidador    String?      @db.Uuid
  idSesion      Int?
  DESCRIPCION   DESCRIPCION?
  GROUNDTRUTH   GROUNDTRUTH?
  SESION        SESION?      @relation(fields: [idSesion], references: [idSesion], onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model PUNTAJE {
  idPuntaje             Int         @id @default(autoincrement())
  idDescripcion         Int
  rateOmision           Float
  rateComision          Float
  rateExactitud         Float
  puntajeCoherencia     Float
  puntajeFluidez        Float
  puntajeTotal          Float
  fechaCalculo          DateTime    @default(now()) @db.Timestamptz(6)
  detallesOmitidos      String[]
  palabrasClaveOmitidas String[]
  aciertos              String[]
  conclusion            String?
  elementosComision     String[]
  DESCRIPCION           DESCRIPCION @relation(fields: [idDescripcion], references: [idDescripcion], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model SESION {
  idSesion             Int           @id @default(autoincrement())
  fechaInicioPropuesta DateTime?     @db.Timestamptz(6)
  estado               estado_sesion @default(pendiente)
  sessionRecall        Float
  sessionComision      Float
  sessionCoherencia    Float
  sessionTotal         Float
  conclusionTecnica    String?
  sessionFluidez       Float         @default(0)
  conclusionNormal     String        @default("")
  sessionOmision       Float?        @default(0)
  idPaciente           String?       @db.Uuid
  fechaCreacion        DateTime?     @db.Timestamptz(6)
  activacion           Boolean?      @default(false)
  notasMedico          String?
  fechaRevisionMedico  DateTime?     @db.Timestamptz(6)
  IMAGEN               IMAGEN[]
}

model VW_PromediosPorSesion {
  idSesion              Int     @id           @map("idSesion")
  PromedioOmision       Float?  @map("PromedioOmision")
  PromedioComision      Float?  @map("PromedioComision")
  PromedioExactitud     Float?  @map("PromedioExactitud")
  PromedioCoherencia    Float?  @map("PromedioCoherencia")
  PromedioFluidez       Float?  @map("PromedioFluidez")
  PuntajeTotalPromedio  Float?  @map("PuntajeTotalPromedio")

  @@map("VW_PromediosPorSesion") 
}

enum estado_sesion {
  en_curso
  pendiente
  completado
}
